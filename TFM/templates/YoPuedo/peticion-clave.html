<form class="form modal-content" hx-post="{% url 'validar_clave' %}">
  <div class="modal-header">
    <h5 class="modal-title font-weight-bold" id="validar_clave_label">
      ¿Eres tú?
    </h5>
  </div>
  <div class="modal-body container">
    {% csrf_token %}
    <div class="row align-items-center">
        <div class="col-10">
            <h4>
                Te acabamos de mandar un correo con un código de
                verificación para asegurarnos que eres tú quien realiza
                esta acción. Por favor, ábrelo y escribe o di el código que
                hay dentro de él para continuar:
            </h4>
        </div>
        <div class="col">
            {% include 'YoPuedo/altavoz.html' %}
        </div>
    </div>

    {% for field in peticion_clave %}
    <div class='form-group {% if field.errors %} errorlist {% endif %}'>
      {% if field.name == "clave" %}
        <i class="bi bi-hand-thumbs-up-fill"></i>
            {{ field.label }}

          <div class="container inputs">
            <div class="row align-items-center">
              <div class="col-10">
                {{ field }}
              </div>
              <div class="col">
                {% include 'YoPuedo/microfono.html' %}
              </div>
            </div>
          </div>

          {% for error in field.errors%}
          <div class="errorlist">
            <i class="bi bi-x-circle-fill"></i>
            {{ error }}
          </div>
          {% endfor %}
      {% else %}
        {{ field }}
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <div class="modal-footer">
    <button id="boton-registro" type="submit" class="btn btn-primary principales">
      <i class="bi bi-check"></i>
      VERIFICAR
    </button>
  </div>
</form>

<script>
  ;(function () {
  const modal = new bootstrap.Modal(document.getElementById("validar_clave"))

  htmx.on("htmx:afterSwap", (e) => {
    // Response targeting #dialog => show the modal
    if (e.detail.target.id == "dialog-clave") {
      modal.show()
    }
  })

  htmx.on("htmx:beforeSwap", (e) => {
    // Empty response targeting #dialog => hide the modal
    if (e.detail.target.id == "dialog-clave" && !e.detail.xhr.response) {
      modal.hide()
      e.detail.shouldSwap = false
    }
  })

  // Remove dialog content after hiding
  htmx.on("hidden.bs.modal", () => {
    document.getElementById("dialog-clave").innerHTML = ""
  })
})()
</script>